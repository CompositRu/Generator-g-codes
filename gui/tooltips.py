'''
Модуль для управления всплывающими подсказками (tooltips).

Содержит маппинг названий параметров к их описаниям из parameters_description.md
'''

from TkToolTip import ToolTip


# Словарь с описаниями параметров для tooltips
TOOLTIPS = {
    # Основные параметры слоев
    "Количество слоёв": "Количество рабочих слоёв материала, которые будут пробиты",
    "Количество пустых слоёв": "Количество холостых (виртуальных) слоёв для допробивки последних реальных слоёв материала",
    "Толщина слоя": "Толщина одного слоя материала в миллиметрах",
    "Толщина слоя (мм)": "Толщина одного слоя материала в миллиметрах",

    # Параметры пробивки
    "Расстояние от каркаса до головы перед ударом": "Высота в мм, на котором игольная голова останавливается перед ударом",
    "Расстояние от каркаса до головы перед ударом (мм)": "Высота в мм, на котором игольная голова останавливается перед ударом",
    "Скорость": "Скорость перемещения осей станка в мм/мин",
    "Скорость (мм/мин)": "Скорость перемещения осей станка в мм/мин",
    "X": "Координата или скорость по оси X (значение зависит от контекста)",
    "Y": "Координата или скорость по оси Y (значение зависит от контекста)",
    "Z": "Координата Z для позиции укладки нового слоя оператором",
    "Движение осей X и Y": "Скорость перемещения головы по осям X и Y в мм/мин (обычно 500-5000)",
    "Внедрение игл по Z": "Скорость движения вниз (удар) по оси Z в мм/мин",
    "Извлечение игл по Z": "Скорость движения вверх (извлечение) по оси Z в мм/мин",
    "Ускорение осей станка": "Ускорение линейных осей станка в мм/с². Используется для расчёта времени выполнения (не записывается в G-код)",
    "Ускорение осей станка (мм/с²)": "Ускорение линейных осей станка в мм/с². Используется для расчёта времени выполнения (не записывается в G-код)",
    "Смена осей X↔Y": "Меняет местами оси X и Y в генерируемых командах перемещения. Полезно при нестандартной ориентации станка",

    # Секция пробивки
    "Пробивка": "Параметры глубины пробивки материала иглами",
    "Пробивка с нарастанием глубины": "Включает режим постепенного увеличения глубины удара с каждым слоем",
    "Начальная глубина удара": "Глубина удара для первого слоя. Далее растёт на толщину слоя с каждым новым слоем",
    "Начальная глубина удара (мм)": "Глубина удара для первого слоя. Далее растёт на толщину слоя с каждым новым слоем",
    "Глубина удара": "Максимальная глубина удара (при нарастании) или постоянная глубина (без нарастания)",
    "Глубина удара (мм)": "Максимальная глубина удара (при нарастании) или постоянная глубина (без нарастания)",

    # Параметры паттерна
    "Параметры паттерна": "Настройки паттерна пробивки: форма, количество ударов и распределение точек",
    "Автоматическое определение формы паттерна": "Автоматически рассчитывает оптимальные значения nx и ny на основе количества ударов",
    "nx": "Количество точек пробивки по оси X в одной ячейке между иглами",
    "ny": "Количество точек пробивки по оси Y в одной ячейке между иглами",
    "Кол-во ударов": "Общее количество ударов иглами на один слой для полного заполнения ячейки между иглами. Определяет плотность пробивки",

    # Позиция при ручной укладке слоя
    "Позиция при ручной укладке слоя": "Координаты, на которые перемещается голова для укладки нового слоя оператором",
    "Позиция при ручной укладки слоя": "Координаты, на которые перемещается голова для укладки нового слоя оператором",
    "Пауза в конце слоя": "Время паузы в секундах после завершения слоя для укладки нового материала оператором",
    "Пауза в конце слоя (сек)": "Время паузы в секундах после завершения слоя для укладки нового материала оператором",
    "Звуковой сигнал": "Длительность звукового сигнала в секундах для оповещения оператора о необходимости укладки нового слоя",
    "Звуковой сигнал (сек)": "Длительность звукового сигнала в секундах для оповещения оператора о необходимости укладки нового слоя",
    "Режим звукового сигнала": "Режим работы звукового сигнала: непрерывный, прерывистый или частый прерывистый",
    "Рост Z с каждым слоем": "Увеличивать ли высоту позиции укладки слоя с каждым новым слоем (Z + толщина_слоя × номер_слоя)",

    # Расстояние между иглами
    "Расстояние между иглами": "Расстояние между иглами в миллиметрах. Определяет размер ячейки паттерна. Исторически = 8 мм",
    "Расстояние между иглами (мм)": "Расстояние между иглами в миллиметрах. Определяет размер ячейки паттерна. Исторически = 8 мм",

    # Новые поля для настройки игольниц
    "needle_spacing_x": "Расстояние между иглами по оси X для данной игольницы в миллиметрах",
    "needle_spacing_y": "Расстояние между иглами по оси Y для данной игольницы в миллиметрах",
    "Расст. X (мм)": "Расстояние между иглами по оси X для данной игольницы в миллиметрах",
    "Расст. Y (мм)": "Расстояние между иглами по оси Y для данной игольницы в миллиметрах",

    # Количество шагов головы
    "Количество шагов головы": "Количество позиций игольной головы по осям X и Y. Каждый шаг = одна позиция для пробивки",

    # Габариты каркаса
    "Габариты каркаса": "Желаемая длина каркаса в миллиметрах по осям X и Y",

    # Опции генерации
    "Случайный порядок ударов": "Случайная перестановка точек в паттерне пробивки для равномерного распределения нагрузки",
    "Случайные смещения": "Добавление случайного смещения к каждой точке пробивки для создания более естественного паттерна",
    "Коэффициент случайных смещений": "Максимальная величина случайного смещения в миллиметрах (обычно 0.1-0.25 мм)",
    "Чередование направлений прохода слоя": "Изменение направления движения головы на каждом четном слое. Устраняет эффект волны на каркасе",
    "Порядок прохождения рядов": "Последовательность обхода рядов по оси Y. Влияет на качество пробивки и предотвращает образование горбов",

    # Параметры файла
    "Создание файла на рабочем столе": "Сохранять файл на рабочий стол (~/Desktop/<имя_головы>/) или в директорию программы",
    "Автоматическая генерация имени файла": "Формировать имя файла автоматически на основе параметров (например, 250x250x8_10_ударов_лаб_Г1.tap)",
    "Имя файла": "Имя для сохранения .tap файла (доступно только при выключенной автогенерации)",

    # Настройки игольницы
    "ИП голова": "Тип игольной головы из предустановленных конфигураций. Определяет количество игл и изображение головы",
    "Игольницы (ИП головы)": "Параметры выбранной игольной головы: количество игл по X и Y",

    # Количество игл в игольнице
    "Количество игл X": "Количество игл в игольнице по оси X (горизонталь)",
    "Количество игл Y": "Количество игл в игольнице по оси Y (вертикаль)",
}


def add_tooltip(widget, text, delay=0.5):
    """
    Добавляет всплывающую подсказку к виджету.

    Args:
        widget: Tkinter виджет
        text: Текст подсказки
        delay: Задержка перед показом в секундах (по умолчанию 0.5)
    """
    if text:
        ToolTip(widget, text=text, delay=delay, background="#ffffe0",
                text_color="#000000", relief="solid", borderwidth=1)


def add_tooltip_by_name(widget, param_name, delay=0.5):
    """
    Добавляет всплывающую подсказку к виджету на основе имени параметра.

    Args:
        widget: Tkinter виджет
        param_name: Название параметра из словаря TOOLTIPS
        delay: Задержка перед показом в секундах (по умолчанию 0.5)
    """
    tooltip_text = TOOLTIPS.get(param_name)
    if tooltip_text:
        add_tooltip(widget, tooltip_text, delay)
